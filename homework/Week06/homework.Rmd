Week 6 Homework
==============
## 书面作业
### 6.3
```{r echo=FALSE, results='hide'}
x<-c(1,1,1,1,2,2,2,3,3,3,4,4,4,5,6,6,6,7,7,7,8,8,8,9,11,12,12,12)
y<-c(0.6,1.6,0.5,1.2,2.0,1.3,2.5,2.2,2.4,1.2,3.5,4.1,5.1,5.7,3.4,9.7,8.6,4.0,5.5,10.5,17.5,13.4,4.5,30.4,12.4,13.4,26.2,7.4)
```
#### (1) 画出数据的散点图, 求回归直线$y=\overset{_{\verb|^|}}\beta_0+\overset{_{\verb|^|}}\beta_1x$,同时将回归直线也画在散点图上. 
```{r}
plot(x,y)
lm.sol<-lm(y~1+x)
abline(lm.sol)
```
#### (2) 分析t检验和F检验是否通过
```{r}
summary(lm.sol)
```
t检验 $\beta_1$项很显著，但常数项$\beta_0$不显著。
F检验 通过

#### (3) 画出残差(普通残差和标准化残差)与预测值的残差图,分析误差是否是等方差的.
普通残差与预测值的残差图
```{r}
y.res<-resid(lm.sol) #
y.fit<-predict(lm.sol)
plot(y.res~y.fit)
```
标准化残差与预测值的残差图
```{r}
y.rst <- rstandard(lm.sol) #
y.fit<-predict(lm.sol)
plot(y.rst~y.fit)
```
可见,残差并非是等方差的。
#### (4) 修正模型, 对响应变量Y做开方, 再完成(1) ~ (3)的工作.
```{r}
lm.new<-update(lm.sol,sqrt(.)~.)
summary(lm.new)
```
此时所有参数和方程均通过检验。

此时的残差图为:

>普通残差与预测值的残差图
```{r}
y.res<-resid(lm.new) #
y.fit<-predict(lm.new)
plot(y.res~y.fit)
```
>标准化残差与预测值的残差图
```{r}
y.rst <- rstandard(lm.new) #
y.fit<-predict(lm.new)
plot(y.rst~y.fit)
```

### 6.4
```{r}
toothpaste<-data.frame(
  X1=c(-0.05, 0.25,0.60,0,0.20, 0.15,-0.15, 0.15,0.10,0.40,0.45,0.35,0.30, 0.50,0.50,0.40,-0.05,-0.05,-0.10,0.20,0.10,0.50,0.60,-0.05,0,0.05,0.55),
  X2=c(5.50,6.75,7.25,5.50,6.50,6.75,5.25,6.00,6.25,7.00,6.90,6.80,6.80,7.10,7.00,6.80,6.50,6.25,6.00,6.50,7.00,6.80,6.80,6.50,5.75,5.80,6.80),
  Y=c(7.38,8.51,9.52,7.50,8.28,8.75,7.10,8.00,8.15,9.10,8.86,8.90,8.87,9.26,9.00,8.75,7.95, 7.65,7.27,8.00,8.50,8.75,9.21,8.27,7.67,7.93,9.26)
)
lm.sol<-lm(Y~X1+X2,data=toothpaste); 
summary(lm.sol)
```
回归诊断：
```{r}
influence.measures(lm.sol)
```

### 6.5
诊断水泥数据是否存在多重共线性,
```{r}
cement<-data.frame(X1=c( 7,  1, 11, 11,  7, 11,  3,  1,  2, 21,  1, 11, 10),X2=c(26, 29, 56, 31, 52, 55, 71, 31, 54, 47, 40, 66, 68),X3=c( 6, 15,  8,  8,  6,  9, 17, 22, 18,  4, 23,  9,  8),X4=c(60, 52, 20, 47, 33, 22,  6, 44, 22, 26, 34, 12, 12),Y =c(78.5, 74.3, 104.3,  87.6,  95.9, 109.2, 102.7, 72.5, 93.1,115.9,  83.8, 113.3, 109.4))
XX <- cor(cement[1:4])
kappa(XX, exact=T)
```
可见, $k$大于1000, 有严重的共线性.

分析例6.10中的step()函数去掉的变量是否合理. 
```{r}
eigen(XX)
```
可以忽略X4项，可以看出X1，X2，X3存在共线性。
按照例6.10中的描述,删去X3和X4后：
```{r}
xx<-cor(cement[1:2])
kappa(xx,exact=T)
```
无共线性
可以认为step函数去除的X3,X4是合理的

### 6.6
为研究一些因素(如用抗生素, 有无危险因子, 事先是否有计划)对"剖腹产后是否有感染"的影响,使用logistic回归模型对这些数据进行研究,分析感染与这些因素的关系.
```{r}
infection<-data.frame(x1<-c(0,1,0,0,0,1,1,1),x2<-c(0,0,1,0,1,0,1,1),x3<-c(0,0,0,1,1,1,0,1),success<-c(0,0,23,8,28,0,11,1),fail<-c(9,0,3,32,30,2,87,17))
infection$Ymat<-cbind(infection$success,infection$fail)
infection$Ymat
glm.sol<-glm(Ymat~x1+x2+x3,family=binomial,data=infection)
summary(glm.sol)

```
回归模型为P=exp(-0.821-3.254x1+2.030x2-1.072x3)/(1+exp(-0.821-3.254x1+2.030x2-1.072x3))

### 6.8
#### (1)
```{r}
cancer<-read.table("cancer.dat", header=T)
glm.sol<-glm(y~x1+x2+x3+x4+x5,family=binomial,data=cancer);
summary(glm.sol)
```
可见,有些系数并不对最终的生存时间有显著影响.
此时各个病人的P(Y=1)的概率如下
```{r}
pre <- predict(glm.sol, cancer[,1:5] )
p <- exp(pre)/(1+exp(pre))
p
```

#### (2)
```{r}
glm.new<-step(glm.sol)
summary(glm.new)
```

此时各个病人的P(Y=1)的概率如下
```{r}
pre <- predict(glm.new, cancer[,1:5] )
p <- exp(pre)/(1+exp(pre))
p
```
回归方程为$P=exp(-6.13755+0.09759x1-1.12524x4)/(1+exp(-6.13755+0.09759x1-1.12524x4))$


